name: Build and Send Link

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 8.0.x

    - name: Publish Application
      # We are compressing it into a single file. It will be large (~160MB) but requires no installation.
      run: dotnet publish -c Release -r win-x64 /p:PublishSingleFile=true /p:SelfContained=true -o ./publish

    - name: Upload and Message
      run: |
        # 1. Upload the file to transfer.sh (Free, secure, temporary hosting)
        # We capture the output URL into a variable
        $url = curl --upload-file "./publish/ZenFocus.exe" "https://transfer.sh/ZenFocus.exe"
        
        Write-Host "File uploaded to: $url"

        # 2. Send that URL to your Telegram
        $message = "âœ… Build Success! Download your app here: $url"
        
        curl -F "chat_id=${{ secrets.TELEGRAM_TO }}" -F "text=$message" https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage
